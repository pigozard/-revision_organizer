<div class="modern-chat-container">
  <!-- Sidebar gauche avec infos du bloc -->
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <%= link_to blocs_path, class: "back-btn" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
        </svg>
        Retour
      <% end %>
    </div>

    <div class="sidebar-content">
      <div class="bloc-info-card">
        <div class="bloc-badge">BLOC</div>
        <h2 class="bloc-title"><%= @chat.bloc.name %></h2>
        <div class="bloc-description">

        </div>
      </div>
    </div>
  </div>

  <!-- Zone de chat principale -->
  <div class="chat-main">
    <!-- Header du chat -->
    <div class="chat-header-modern">
      <div class="chat-header-content">
        <div class="chat-status">
          <div class="status-dot"></div>
          <span>IA Active</span>

        </div>
        <h1 class="chat-title-modern" id="chat_title">
          <%= @chat.title %>
        </h1>
      </div>
    </div>

    <!-- Messages -->
    <div class="messages-modern-container" id="messages">
      <% if @chat.messages.any? %>
        <% @chat.messages.each do |message| %>
          <% if message.role == "user" %>
            <!-- Message utilisateur -->
            <div class="message-modern user">
              <div class="message-avatar">
                <div class="avatar-user">

                </div>
              </div>
              <div class="message-content-modern">
                <div class="message-header-info">
                  <span class="message-author"><%= current_user.pseudo %></span>
                  <span class="message-time-info">
                    <%= message.created_at.strftime("%H:%M") %>
                  </span>
                </div>
                <div class="message-bubble-modern">
                  <%= raw(message.content) %>
                </div>
              </div>
            </div>
          <% elsif message.role == "assistant" %>
            <!-- Message assistant -->
            <div class="message-modern assistant">
              <div class="message-avatar">
                <div class="avatar-ai">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM5.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM8 13a3.5 3.5 0 0 1-3.5-3.5h7A3.5 3.5 0 0 1 8 13z"/>
                  </svg>
                </div>
              </div>
              <div class="message-content-modern">
                <div class="message-header-info">
                  <span class="message-author">Assistant IA</span>
                  <span class="message-time-info">
                    <%= message.created_at.strftime("%H:%M") %>
                  </span>
                </div>
                <div class="message-bubble-modern">
                  <%= raw(message.content) %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <!-- Ã‰tat vide -->
        <div class="empty-chat-state">
          <div class="empty-icon">ðŸ’¬</div>
          <h3>Commence la conversation</h3>
          <p>Pose ta premiÃ¨re question pour dÃ©marrer l'apprentissage</p>
        </div>
      <% end %>
    </div>

    <!-- Formulaire de message -->
    <div class="chat-input-modern" id="new_message_container">
      <%= simple_form_for [@chat, @message], html: { class: "modern-form-clean" } do |f| %>
        <div class="input-container-clean">
          <%= f.input :content,
              label: false,
              required: true,
              placeholder: "Pose ta question sur #{@chat.bloc.name}...",
              wrapper: false,
              input_html: { class: 'input-clean' } %>
              <%= f.input :file, as: :file, label: "Upload a file (PDF)" %>
          <%= f.button :submit, class: 'btn btn-primary', type: 'submit' do %>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
              <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
            </svg>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
